import React, { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';

export type Lang = 'ru' | 'en' | 'kk';

type Params = Record<string, string | number | undefined | null>;

const STORAGE_KEY = 'bolashak_lang';

const MESSAGES: Record<Lang, Record<string, string>> = {
  ru: {
    'lang.ru': 'Рус',
    'lang.en': 'Eng',
    'lang.kk': 'Қаз',
    'lang.label': 'Язык',

    'nav.navigation': 'Навигация',
    'nav.dashboard': 'Дашборд',
    'nav.notifications': 'Уведомления',
    'nav.docs': 'Документы',
    'nav.profile': 'Профиль',
    'nav.neuroAgents': 'Нейро-Агенты',
    'nav.management': 'Управление',
    'nav.systemMonitor': 'Системный монитор',
    'nav.logout': 'Выйти из системы',

    'dashboard.digitalCampusOnline': 'Цифровой кампус онлайн',
    'dashboard.welcome': 'Добро пожаловать,',
    'dashboard.heroText':
      'Интеллектуальная система Университета Болашак готова к работе. Используйте голосовой ввод или загрузку документов для взаимодействия с сервисами.',
    'dashboard.quickStart': 'Быстрый старт',
    'dashboard.myCertificates': 'Мои справки',
    'dashboard.currentStatus': 'Текущий статус',
    'dashboard.attendance': 'Посещаемость',
    'dashboard.availableServices': 'Доступные сервисы',
    'dashboard.showAll': 'Показать все',
    'dashboard.availableToStudents': 'Доступно студентам',
    'dashboard.searchPlaceholder': 'Найти сервис, документ или человека...',
    'dashboard.nothingFound': 'Ничего не найдено. Нажмите Enter для поиска в «Документах».',
    'dashboard.widget.none': 'Нет',
    'dashboard.widget.newCount': '{count} новых',
    'dashboard.widget.noNotifications': 'Нет уведомлений',
    'dashboard.widget.schedule': 'Расписание',
    'dashboard.widget.deadlines': 'Дедлайны',
    'dashboard.widget.days2': '2 Дня',
    'dashboard.widget.important': 'Важно',
    'dashboard.widget.docsAttachable': 'Можно подключить в чате',
    'dashboard.widget.docsAddToBase': 'Добавьте документы в базу',
    'dashboard.widget.lectureExample': 'Лекция: Основы ИИ (Ауд. 205)',
    'dashboard.widget.courseworkExample': 'Сдача курсовой работы',

    'route.subtitle.dashboard': 'Главная панель',
    'route.subtitle.docs': 'База знаний',
    'route.subtitle.notifications': 'Центр уведомлений',
    'route.subtitle.profile': 'Аккаунт и роль',
    'route.subtitle.admin': 'Админ-панель',
    'route.subtitle.document': 'Документ',

    'auth.ecosystem': 'Экосистема интеллектуальных сервисов',
    'auth.fullName': 'ФИО',
    'auth.yourName': 'Ваше имя',
    'auth.password': 'Пароль',
    'auth.login': 'Войти в систему',
    'auth.createAccount': 'Создать аккаунт',
    'auth.noAccount': 'У меня еще нет аккаунта',
    'auth.haveAccount': 'У меня уже есть аккаунт',
    'auth.err.invalidPassword': 'Неверный пароль.',
    'auth.err.userNotFound': 'Пользователь не найден. Используйте student@bolashak.kz',
    'auth.err.fillAll': 'Заполните все поля',
    'auth.err.passwordMin': 'Пароль должен быть минимум 6 символов.',
    'auth.footer': '© 2025 Цифровой Департамент «Болашак»',

    'profile.updated': 'Данные успешно обновлены в БД',
    'profile.registration': 'Регистрация',
    'profile.fullName': 'Ваше полное имя',
    'profile.department': 'Факультет / Департамент',
    'profile.notSpecified': 'Не указано',
    'profile.accessLevel': 'Уровень доступа',
    'profile.save': 'Сохранить профиль',

    'docs.title': 'Документы',
    'docs.subtitle':
      'Ваша локальная база знаний. В чате можно включить «Документы» для ответов с учетом этих материалов.',
    'docs.upload': 'Загрузить файл',
    'docs.total': 'Всего документов',
    'docs.searchPlaceholder': 'Поиск по названию и тексту…',
    'docs.newDoc': 'Новый документ',
    'docs.docTitle': 'Название',
    'docs.docContentPlaceholder': 'Вставьте текст (можно Markdown)…',
    'docs.add': 'Добавить',
    'docs.list': 'Список',
    'docs.found': 'Найдено: {count}',
    'docs.none': 'Документов пока нет',
    'docs.emptyHelp': 'Загрузите файл или создайте документ вручную.',
    'docs.confirmDelete': 'Удалить документ?',
    'docs.created': 'Создано: {date}',
    'docs.updated': 'Обновлено: {date}',
    'docs.editing': 'Редактирование',
    'docs.text': 'Текст',
    'docs.edit': 'Редактировать',
    'docs.save': 'Сохранить',
    'docs.cancel': 'Отмена',
    'docs.delete': 'Удалить',

    'notifications.title': 'Уведомления',
    'notifications.subtitle': 'Важные объявления, приказы и системные события. Непрочитано:',
    'notifications.markAllRead': 'Отметить все прочитанным',
    'notifications.none': 'Уведомлений нет',
    'notifications.read': 'Прочитано',
    'notifications.open': 'Открыть',

    'vacancies.title': 'Вакансии (HH)',
    'vacancies.searchByQuery': 'Поиск по запросу',
    'vacancies.found': 'Найдено: {count}',
    'vacancies.refresh': 'Обновить',
    'vacancies.refreshTitle': 'Обновить список',
    'vacancies.searchPlaceholder': 'Например: стажировка, junior, преподаватель…',
    'vacancies.err.loadFailed': 'Не удалось загрузить вакансии.',
    'vacancies.err.title': 'Ошибка загрузки',
    'vacancies.err.hint': 'Совет: в dev используйте прокси Vite `/api/hh` (см. `vite.config.ts`)',
    'vacancies.none': 'Нет результатов. Попробуйте другой запрос.',
    'vacancies.openOnHh': 'Открыть на HeadHunter',
    'vacancies.companyUnknown': 'Компания не указана',
    'vacancies.loading': 'Загрузка',
    'vacancies.showMore': 'Показать ещё',
    'vacancies.end': 'Конец списка',
    'vacancies.noMorePages': 'Больше страниц нет',
    'vacancies.showMoreTitle': 'Показать ещё вакансии',

    'chat.export.title': 'Экспорт диалога',
    'chat.export.button': 'Экспорт',
    'chat.clearTitle': 'Очистить чат',
    'chat.useDocsTitle': 'Использовать документы ({count})',
    'chat.useDocsNoneTitle': 'Нет документов. Откройте раздел «Документы».',
    'chat.docsButton': 'Документы',
    'chat.startDialog': 'Начните диалог с {name}',
    'chat.processing': 'Обработка данных',
    'chat.attachmentAdded': 'Изображение прикреплено',
    'chat.attachTitle': 'Прикрепить фото/документ',
    'chat.listening': 'Слушаю вас...',
    'chat.writeMessage': 'Напишите сообщение...',
    'chat.voiceInput': 'Голосовой ввод',
    'chat.speak': 'Озвучить',
    'chat.copyAnswer': 'Скопировать ответ',
    'chat.helpful': 'Полезно',
    'chat.notHelpful': 'Не помогло',
    'chat.alert.voiceUnsupported': 'Ваш браузер не поддерживает голосовой ввод.',
    'chat.confirm.clear': 'Очистить диалог с {name}?',
    'chat.noKey': 'Нет GEMINI_API_KEY',
    'chat.export.md.title': 'Чат с {agent}',
    'chat.export.md.user': 'Пользователь',
    'chat.export.md.exportedAt': 'Экспорт',
    'chat.export.md.attachment': '[вложение: изображение]',
    'chat.docsContextHeader': 'Контекст из ваших документов (локальная база знаний):',

    'common.from': 'от',
    'common.to': 'до',

    'home.goAi': 'Перейти к AI-сервисам',
    'home.ai': 'ИИ',
    'home.auth': 'Авторизация',
    'home.switchUser': 'Сменить пользователя',
    'home.switch': 'Сменить',
    'home.enter': 'Войти',
    'home.about': 'О программе',
    'home.aiSanaTitle': 'AI‑SANA',
    'home.aiSanaSubtitle': 'Траектория технологий • образование • DeepTech',
    'home.communityTitle': 'Комьюнити и события',
    'home.communitySubtitle': 'Партнёры, университеты и индустрия в одной экосистеме',
    'home.programText':
      'AI‑Sana — государственная программа Казахстана, запущенная 11 декабря 2024 года по инициативе Президента и реализуемая Министерством науки и высшего образования. Её цель — подготовить «AI‑нацию» через образование, исследование и запуск DeepTech‑стартапов.',
    'home.programGoals': 'Цели программы',
    'home.goal1': 'Запуск стартапов в области DeepTech.',
    'home.goal2': 'Развитие компетенций в области искусственного интеллекта.',
    'home.goal3': 'Создание исследовательских лабораторий и центров AI‑разработки.',
    'home.goal4': 'Формирование цифровой грамотности у студентов и преподавателей.',
    'home.mainDirections': 'Основные направления',
    'home.dir1': 'Образование и подготовка специалистов в области AI.',
    'home.dir2': 'Коммерциализация и внедрение инноваций в экономику.',
    'home.dir3': 'Интеграция AI‑технологий в университетскую экосистему.',
    'home.dir4': 'Поддержка научных исследований и международных коллабораций.',
    'home.expectedEffects': 'Ожидаемые эффекты',
    'home.effectsText':
      'Программа позволит повысить конкурентоспособность Казахстана в области искусственного интеллекта, обеспечит новые возможности для студентов и преподавателей, а также создаст условия для формирования инновационной экономики будущего.'
    ,

    'agent.abitur.name': 'AI-Abitur',
    'agent.abitur.fullName': 'Помощник абитуриента',
    'agent.abitur.description': 'Цифровой консультант для поступающих в Университет Болашак.',
    'agent.abitur.primaryFunc': 'Консультации по специальностям, перечню документов и условиям поступления в «Болашак».',

    'agent.kadr.name': 'KadrAI',
    'agent.kadr.fullName': 'HR и Документы',
    'agent.kadr.description': 'Единое окно выдачи справок и документов для студентов и сотрудников.',
    'agent.kadr.primaryFunc': 'Справки с места учебы, транскрипты, приказы и кадровые вопросы.',

    'agent.nav.name': 'UniNav',
    'agent.nav.fullName': 'Навигатор студента',
    'agent.nav.description': 'Сопровождение по всем учебным процессам университета.',
    'agent.nav.primaryFunc': 'Расписание, академические вопросы, справки об обучении.',

    'agent.career.name': 'CareerNavigator',
    'agent.career.fullName': 'Карьерный консультант',
    'agent.career.description': 'Помощь в трудоустройстве выпускников и студентов.',
    'agent.career.primaryFunc': 'Поиск вакансий в Кызылорде, советы по резюме.',

    'agent.room.name': 'UniRoom',
    'agent.room.fullName': 'Помощник по общежитию',
    'agent.room.description': 'Решение бытовых и административных вопросов в Доме студентов.',
    'agent.room.primaryFunc': 'Заселение, заявки на ремонт, правила проживания.'
    ,

    'admin.title': 'Система управления Bolashak AI',
    'admin.subtitle': 'Мониторинг, пользователи, уведомления, аудит и резервные копии.',
    'admin.tab.stats': 'Аналитика',
    'admin.tab.users': 'Пользователи',
    'admin.tab.broadcast': 'Рассылка',
    'admin.tab.audit': 'Аудит',
    'admin.tab.backup': 'Бэкап',
    'admin.stat.requests': 'Запросов',
    'admin.stat.requestsSub': 'Всего (user-msg)',
    'admin.stat.avgLatencySub': 'Средняя задержка',
    'admin.stat.ratings': 'Оценок: {count}',
    'admin.stat.users': 'Пользователи',
    'admin.chart.byAgents': 'Запросы по агентам',
    'admin.chart.trend14': 'Динамика (14 дней)',
    'admin.nodes.status': 'Статус нейро-узлов',
    'admin.users.title': 'Пользователи',
    'admin.users.subtitle': 'Поиск, роли и департаменты (локально в браузере).',
    'admin.users.searchPlaceholder': 'Поиск по имени, email, роли…',
    'admin.users.col.name': 'Имя',
    'admin.users.col.role': 'Роль',
    'admin.users.col.department': 'Департамент',
    'admin.users.add': 'Добавить пользователя',
    'admin.users.placeholder.fullName': 'ФИО',
    'admin.users.placeholder.password': 'Пароль',
    'admin.users.placeholder.departmentOpt': 'Департамент (опц.)',
    'admin.users.create': 'Создать',
    'admin.users.err.passwordMin': 'Пароль должен быть минимум 6 символов.',
    'admin.users.err.emailExists': 'Пользователь с таким email уже существует.',
    'admin.broadcast.defaultTitle': 'Объявление',
    'admin.broadcast.title': 'Рассылка уведомлений',
    'admin.broadcast.subtitle': 'Отправляет сообщение всем пользователям (localStorage).',
    'admin.broadcast.total': 'Всего уведомлений: {count}',
    'admin.broadcast.placeholder.title': 'Заголовок',
    'admin.broadcast.placeholder.message': 'Текст сообщения…',
    'admin.broadcast.params': 'Параметры',
    'admin.broadcast.sendAll': 'Отправить всем',
    'admin.broadcast.sent': 'Уведомление отправлено всем пользователям.',
    'admin.broadcast.tip': 'Совет: покажите комиссии, как уведомление появляется у студента (раздел «Уведомления»).',
    'admin.audit.title': 'Аудит (последние события)',
    'admin.audit.subtitle': 'Локальный журнал действий (чат, документы, админ-панель).',
    'admin.audit.confirmClear': 'Очистить аудит?',
    'admin.audit.clear': 'Очистить',
    'admin.audit.none': 'Событий пока нет',
    'admin.backup.title': 'Резервные копии',
    'admin.backup.subtitle': 'Экспорт/импорт данных (users/messages/docs/notifications/feedback/audit).',
    'admin.backup.exportJson': 'Экспорт JSON',
    'admin.backup.import': 'Импорт',
    'admin.backup.chooseFile': 'Выбрать файл',
    'admin.backup.selectFileFirst': 'Сначала выберите файл.',
    'admin.backup.importDone': 'Импорт выполнен. Если интерфейс не обновился, перезагрузите страницу.',
    'admin.backup.instructions': 'Выберите файл бэкапа. Можно заменить данные или объединить (merge).',
    'admin.backup.summary': 'Сводка'
  },
  en: {
    'lang.ru': 'Rus',
    'lang.en': 'Eng',
    'lang.kk': 'Kaz',
    'lang.label': 'Language',

    'nav.navigation': 'Navigation',
    'nav.dashboard': 'Dashboard',
    'nav.notifications': 'Notifications',
    'nav.docs': 'Documents',
    'nav.profile': 'Profile',
    'nav.neuroAgents': 'AI Agents',
    'nav.management': 'Management',
    'nav.systemMonitor': 'System Monitor',
    'nav.logout': 'Sign out',

    'dashboard.digitalCampusOnline': 'Digital campus online',
    'dashboard.welcome': 'Welcome,',
    'dashboard.heroText':
      'Bolashak University’s intelligent system is ready. Use voice input or upload documents to interact with services.',
    'dashboard.quickStart': 'Quick start',
    'dashboard.myCertificates': 'My certificates',
    'dashboard.currentStatus': 'Current status',
    'dashboard.attendance': 'Attendance',
    'dashboard.availableServices': 'Available services',
    'dashboard.showAll': 'Show all',
    'dashboard.availableToStudents': 'Available for students',
    'dashboard.searchPlaceholder': 'Find a service, document, or person...',
    'dashboard.nothingFound': 'Nothing found. Press Enter to search in “Documents”.',
    'dashboard.widget.none': 'None',
    'dashboard.widget.newCount': '{count} new',
    'dashboard.widget.noNotifications': 'No notifications',
    'dashboard.widget.schedule': 'Schedule',
    'dashboard.widget.deadlines': 'Deadlines',
    'dashboard.widget.days2': '2 days',
    'dashboard.widget.important': 'Important',
    'dashboard.widget.docsAttachable': 'Can be attached in chat',
    'dashboard.widget.docsAddToBase': 'Add documents to the library',
    'dashboard.widget.lectureExample': 'Lecture: AI Basics (Room 205)',
    'dashboard.widget.courseworkExample': 'Coursework submission',

    'route.subtitle.dashboard': 'Main panel',
    'route.subtitle.docs': 'Knowledge base',
    'route.subtitle.notifications': 'Notification center',
    'route.subtitle.profile': 'Account & role',
    'route.subtitle.admin': 'Admin panel',
    'route.subtitle.document': 'Document',

    'auth.ecosystem': 'Ecosystem of intelligent services',
    'auth.fullName': 'Full name',
    'auth.yourName': 'Your name',
    'auth.password': 'Password',
    'auth.login': 'Sign in',
    'auth.createAccount': 'Create account',
    'auth.noAccount': "I don't have an account yet",
    'auth.haveAccount': 'I already have an account',
    'auth.err.invalidPassword': 'Invalid password.',
    'auth.err.userNotFound': 'User not found. Use student@bolashak.kz',
    'auth.err.fillAll': 'Please fill in all fields',
    'auth.err.passwordMin': 'Password must be at least 6 characters.',
    'auth.footer': '© 2025 Digital Department “Bolashak”',

    'profile.updated': 'Data updated successfully',
    'profile.registration': 'Registered',
    'profile.fullName': 'Your full name',
    'profile.department': 'Faculty / Department',
    'profile.notSpecified': 'Not specified',
    'profile.accessLevel': 'Access level',
    'profile.save': 'Save profile',

    'docs.title': 'Documents',
    'docs.subtitle':
      'Your local knowledge base. In chat you can enable “Documents” to answer using these materials.',
    'docs.upload': 'Upload file',
    'docs.total': 'Total documents',
    'docs.searchPlaceholder': 'Search by title and text…',
    'docs.newDoc': 'New document',
    'docs.docTitle': 'Title',
    'docs.docContentPlaceholder': 'Paste text (Markdown supported)…',
    'docs.add': 'Add',
    'docs.list': 'List',
    'docs.found': 'Found: {count}',
    'docs.none': 'No documents yet',
    'docs.emptyHelp': 'Upload a file or create a document manually.',
    'docs.confirmDelete': 'Delete the document?',
    'docs.created': 'Created: {date}',
    'docs.updated': 'Updated: {date}',
    'docs.editing': 'Editing',
    'docs.text': 'Text',
    'docs.edit': 'Edit',
    'docs.save': 'Save',
    'docs.cancel': 'Cancel',
    'docs.delete': 'Delete',

    'notifications.title': 'Notifications',
    'notifications.subtitle': 'Important announcements and system events. Unread:',
    'notifications.markAllRead': 'Mark all as read',
    'notifications.none': 'No notifications',
    'notifications.read': 'Read',
    'notifications.open': 'Open',

    'vacancies.title': 'Vacancies (HH)',
    'vacancies.searchByQuery': 'Search by query',
    'vacancies.found': 'Found: {count}',
    'vacancies.refresh': 'Refresh',
    'vacancies.refreshTitle': 'Refresh list',
    'vacancies.searchPlaceholder': 'For example: internship, junior, teacher…',
    'vacancies.err.loadFailed': 'Failed to load vacancies.',
    'vacancies.err.title': 'Loading error',
    'vacancies.err.hint': 'Tip: in dev use Vite proxy `/api/hh` (see `vite.config.ts`)',
    'vacancies.none': 'No results. Try another query.',
    'vacancies.openOnHh': 'Open on HeadHunter',
    'vacancies.companyUnknown': 'Company not specified',
    'vacancies.loading': 'Loading',
    'vacancies.showMore': 'Show more',
    'vacancies.end': 'End of list',
    'vacancies.noMorePages': 'No more pages',
    'vacancies.showMoreTitle': 'Show more vacancies',

    'chat.export.title': 'Export chat',
    'chat.export.button': 'Export',
    'chat.clearTitle': 'Clear chat',
    'chat.useDocsTitle': 'Use documents ({count})',
    'chat.useDocsNoneTitle': 'No documents. Open “Documents”.',
    'chat.docsButton': 'Documents',
    'chat.startDialog': 'Start a chat with {name}',
    'chat.processing': 'Processing',
    'chat.attachmentAdded': 'Image attached',
    'chat.attachTitle': 'Attach photo/document',
    'chat.listening': "I'm listening...",
    'chat.writeMessage': 'Type a message...',
    'chat.voiceInput': 'Voice input',
    'chat.speak': 'Speak',
    'chat.copyAnswer': 'Copy answer',
    'chat.helpful': 'Helpful',
    'chat.notHelpful': "Didn't help",
    'chat.alert.voiceUnsupported': 'Your browser does not support voice input.',
    'chat.confirm.clear': 'Clear chat with {name}?',
    'chat.noKey': 'No GEMINI_API_KEY',
    'chat.export.md.title': 'Chat with {agent}',
    'chat.export.md.user': 'User',
    'chat.export.md.exportedAt': 'Exported',
    'chat.export.md.attachment': '[attachment: image]',
    'chat.docsContextHeader': 'Context from your documents (local knowledge base):',

    'common.from': 'from',
    'common.to': 'to',

    'home.goAi': 'Go to AI services',
    'home.ai': 'AI',
    'home.auth': 'Sign in',
    'home.switchUser': 'Switch user',
    'home.switch': 'Switch',
    'home.enter': 'Enter',
    'home.about': 'About the program',
    'home.aiSanaTitle': 'AI‑SANA',
    'home.aiSanaSubtitle': 'Technology track • education • DeepTech',
    'home.communityTitle': 'Community & events',
    'home.communitySubtitle': 'Partners, universities, and industry in one ecosystem',
    'home.programText':
      'AI‑Sana is a national program of Kazakhstan, launched on December 11, 2024, initiated by the President and implemented by the Ministry of Science and Higher Education. Its goal is to build an “AI nation” through education, research, and launching DeepTech startups.',
    'home.programGoals': 'Program goals',
    'home.goal1': 'Launch DeepTech startups.',
    'home.goal2': 'Develop AI competencies.',
    'home.goal3': 'Create research labs and AI development centers.',
    'home.goal4': 'Improve digital literacy among students and teachers.',
    'home.mainDirections': 'Key directions',
    'home.dir1': 'Education and training AI specialists.',
    'home.dir2': 'Commercialization and adoption of innovations.',
    'home.dir3': 'Integrating AI technologies into the university ecosystem.',
    'home.dir4': 'Supporting research and international collaborations.',
    'home.expectedEffects': 'Expected outcomes',
    'home.effectsText':
      'The program will strengthen Kazakhstan’s competitiveness in AI, open new opportunities for students and faculty, and help shape an innovation economy of the future.'
    ,

    'agent.abitur.name': 'AI-Abitur',
    'agent.abitur.fullName': 'Admissions assistant',
    'agent.abitur.description': 'A digital consultant for applicants to Bolashak University.',
    'agent.abitur.primaryFunc': 'Guidance on majors, required documents, and admission rules.',

    'agent.kadr.name': 'KadrAI',
    'agent.kadr.fullName': 'HR & Documents',
    'agent.kadr.description': 'One-stop service for certificates and documents for students and staff.',
    'agent.kadr.primaryFunc': 'Study certificates, transcripts, orders, and HR questions.',

    'agent.nav.name': 'UniNav',
    'agent.nav.fullName': 'Student navigator',
    'agent.nav.description': 'Support for all university academic processes.',
    'agent.nav.primaryFunc': 'Schedule, academic questions, study certificates.',

    'agent.career.name': 'CareerNavigator',
    'agent.career.fullName': 'Career consultant',
    'agent.career.description': 'Job search support for graduates and students.',
    'agent.career.primaryFunc': 'Vacancies search in Kyzylorda, CV tips.',

    'agent.room.name': 'UniRoom',
    'agent.room.fullName': 'Dorm assistant',
    'agent.room.description': 'Everyday and administrative issues in the student dorm.',
    'agent.room.primaryFunc': 'Move-in, repair requests, living rules.'
    ,

    'admin.title': 'Bolashak AI Admin Console',
    'admin.subtitle': 'Monitoring, users, notifications, audit, and backups.',
    'admin.tab.stats': 'Analytics',
    'admin.tab.users': 'Users',
    'admin.tab.broadcast': 'Broadcast',
    'admin.tab.audit': 'Audit',
    'admin.tab.backup': 'Backup',
    'admin.stat.requests': 'Requests',
    'admin.stat.requestsSub': 'Total (user-msg)',
    'admin.stat.avgLatencySub': 'Average latency',
    'admin.stat.ratings': 'Ratings: {count}',
    'admin.stat.users': 'Users',
    'admin.chart.byAgents': 'Requests by agent',
    'admin.chart.trend14': 'Trend (14 days)',
    'admin.nodes.status': 'AI node status',
    'admin.users.title': 'Users',
    'admin.users.subtitle': 'Search, roles, and departments (local in browser).',
    'admin.users.searchPlaceholder': 'Search by name, email, role…',
    'admin.users.col.name': 'Name',
    'admin.users.col.role': 'Role',
    'admin.users.col.department': 'Department',
    'admin.users.add': 'Add user',
    'admin.users.placeholder.fullName': 'Full name',
    'admin.users.placeholder.password': 'Password',
    'admin.users.placeholder.departmentOpt': 'Department (optional)',
    'admin.users.create': 'Create',
    'admin.users.err.passwordMin': 'Password must be at least 6 characters.',
    'admin.users.err.emailExists': 'A user with this email already exists.',
    'admin.broadcast.defaultTitle': 'Announcement',
    'admin.broadcast.title': 'Broadcast notifications',
    'admin.broadcast.subtitle': 'Sends a message to all users (localStorage).',
    'admin.broadcast.total': 'Total notifications: {count}',
    'admin.broadcast.placeholder.title': 'Title',
    'admin.broadcast.placeholder.message': 'Message text…',
    'admin.broadcast.params': 'Options',
    'admin.broadcast.sendAll': 'Send to all',
    'admin.broadcast.sent': 'Notification sent to all users.',
    'admin.broadcast.tip': 'Tip: show how a notification appears for a student (see “Notifications”).',
    'admin.audit.title': 'Audit (latest events)',
    'admin.audit.subtitle': 'Local activity log (chat, documents, admin panel).',
    'admin.audit.confirmClear': 'Clear audit log?',
    'admin.audit.clear': 'Clear',
    'admin.audit.none': 'No events yet',
    'admin.backup.title': 'Backups',
    'admin.backup.subtitle': 'Export/import data (users/messages/docs/notifications/feedback/audit).',
    'admin.backup.exportJson': 'Export JSON',
    'admin.backup.import': 'Import',
    'admin.backup.chooseFile': 'Choose file',
    'admin.backup.selectFileFirst': 'Please choose a file first.',
    'admin.backup.importDone': 'Import completed. If the UI did not refresh, reload the page.',
    'admin.backup.instructions': 'Choose a backup file. You can replace data or merge.',
    'admin.backup.summary': 'Summary'
  },
  kk: {
    'lang.ru': 'Рус',
    'lang.en': 'Eng',
    'lang.kk': 'Қаз',
    'lang.label': 'Тіл',

    'nav.navigation': 'Навигация',
    'nav.dashboard': 'Басқару панелі',
    'nav.notifications': 'Хабарландырулар',
    'nav.docs': 'Құжаттар',
    'nav.profile': 'Профиль',
    'nav.neuroAgents': 'AI агенттер',
    'nav.management': 'Басқару',
    'nav.systemMonitor': 'Жүйе мониторы',
    'nav.logout': 'Шығу',

    'dashboard.digitalCampusOnline': 'Цифрлық кампус онлайн',
    'dashboard.welcome': 'Қош келдіңіз,',
    'dashboard.heroText':
      'Bolashak университетінің интеллектуалды жүйесі жұмысқа дайын. Қызметтермен әрекеттесу үшін дауыс енгізуді немесе құжат жүктеуді пайдаланыңыз.',
    'dashboard.quickStart': 'Жылдам бастау',
    'dashboard.myCertificates': 'Анықтамаларым',
    'dashboard.currentStatus': 'Ағымдағы мәртебе',
    'dashboard.attendance': 'Қатысу',
    'dashboard.availableServices': 'Қолжетімді сервистер',
    'dashboard.showAll': 'Барлығын көрсету',
    'dashboard.availableToStudents': 'Студенттерге қолжетімді',
    'dashboard.searchPlaceholder': 'Сервис, құжат немесе адам іздеу...',
    'dashboard.nothingFound': 'Ештеңе табылмады. “Құжаттар” ішінде іздеу үшін Enter басыңыз.',
    'dashboard.widget.none': 'Жоқ',
    'dashboard.widget.newCount': '{count} жаңа',
    'dashboard.widget.noNotifications': 'Хабарландыру жоқ',
    'dashboard.widget.schedule': 'Кесте',
    'dashboard.widget.deadlines': 'Мерзімдер',
    'dashboard.widget.days2': '2 күн',
    'dashboard.widget.important': 'Маңызды',
    'dashboard.widget.docsAttachable': 'Чатта қосуға болады',
    'dashboard.widget.docsAddToBase': 'Құжаттарды базаға қосыңыз',
    'dashboard.widget.lectureExample': 'Дәріс: AI негіздері (205 аудит.)',
    'dashboard.widget.courseworkExample': 'Курстық жұмысты тапсыру',

    'route.subtitle.dashboard': 'Негізгі панель',
    'route.subtitle.docs': 'Білім қоры',
    'route.subtitle.notifications': 'Хабарландыру орталығы',
    'route.subtitle.profile': 'Аккаунт және рөл',
    'route.subtitle.admin': 'Әкімші панелі',
    'route.subtitle.document': 'Құжат',

    'auth.ecosystem': 'Интеллектуалды сервистер экожүйесі',
    'auth.fullName': 'Аты-жөні',
    'auth.yourName': 'Атыңыз',
    'auth.password': 'Құпиясөз',
    'auth.login': 'Кіру',
    'auth.createAccount': 'Аккаунт ашу',
    'auth.noAccount': 'Менде аккаунт жоқ',
    'auth.haveAccount': 'Менде аккаунт бар',
    'auth.err.invalidPassword': 'Құпиясөз қате.',
    'auth.err.userNotFound': 'Пайдаланушы табылмады. student@bolashak.kz қолданыңыз',
    'auth.err.fillAll': 'Барлық өрістерді толтырыңыз',
    'auth.err.passwordMin': 'Құпиясөз кемінде 6 таңба болуы керек.',
    'auth.footer': '© 2025 «Bolashak» цифрлық департаменті',

    'profile.updated': 'Деректер сәтті жаңартылды',
    'profile.registration': 'Тіркелген күні',
    'profile.fullName': 'Толық аты-жөніңіз',
    'profile.department': 'Факультет / Бөлім',
    'profile.notSpecified': 'Көрсетілмеген',
    'profile.accessLevel': 'Қолжетімділік деңгейі',
    'profile.save': 'Профильді сақтау',

    'docs.title': 'Құжаттар',
    'docs.subtitle':
      'Жергілікті білім қорыңыз. Чатта жауап беру үшін “Құжаттар” режимін қосуға болады.',
    'docs.upload': 'Файл жүктеу',
    'docs.total': 'Құжаттар саны',
    'docs.searchPlaceholder': 'Атауы мен мәтіні бойынша іздеу…',
    'docs.newDoc': 'Жаңа құжат',
    'docs.docTitle': 'Атауы',
    'docs.docContentPlaceholder': 'Мәтінді енгізіңіз (Markdown болады)…',
    'docs.add': 'Қосу',
    'docs.list': 'Тізім',
    'docs.found': 'Табылды: {count}',
    'docs.none': 'Құжаттар әзірге жоқ',
    'docs.emptyHelp': 'Файл жүктеңіз немесе құжатты қолмен жасаңыз.',
    'docs.confirmDelete': 'Құжатты жою керек пе?',
    'docs.created': 'Жасалған: {date}',
    'docs.updated': 'Жаңартылған: {date}',
    'docs.editing': 'Өңдеу',
    'docs.text': 'Мәтін',
    'docs.edit': 'Өңдеу',
    'docs.save': 'Сақтау',
    'docs.cancel': 'Бас тарту',
    'docs.delete': 'Жою',

    'notifications.title': 'Хабарландырулар',
    'notifications.subtitle': 'Маңызды хабарламалар және жүйелік оқиғалар. Оқылмаған:',
    'notifications.markAllRead': 'Барлығын оқылды деп белгілеу',
    'notifications.none': 'Хабарландыру жоқ',
    'notifications.read': 'Оқылды',
    'notifications.open': 'Ашу',

    'vacancies.title': 'Вакансиялар (HH)',
    'vacancies.searchByQuery': 'Сұраныс бойынша іздеу',
    'vacancies.found': 'Табылды: {count}',
    'vacancies.refresh': 'Жаңарту',
    'vacancies.refreshTitle': 'Тізімді жаңарту',
    'vacancies.searchPlaceholder': 'Мысалы: стажировка, junior, оқытушы…',
    'vacancies.err.loadFailed': 'Вакансияларды жүктеу мүмкін болмады.',
    'vacancies.err.title': 'Жүктеу қатесі',
    'vacancies.err.hint': 'Кеңес: dev режимінде Vite прокси `/api/hh` қолданыңыз (қараңыз `vite.config.ts`)',
    'vacancies.none': 'Нәтиже жоқ. Басқа сұраныс көріңіз.',
    'vacancies.openOnHh': 'HeadHunter-де ашу',
    'vacancies.companyUnknown': 'Компания көрсетілмеген',
    'vacancies.loading': 'Жүктелуде',
    'vacancies.showMore': 'Көбірек көрсету',
    'vacancies.end': 'Тізім аяқталды',
    'vacancies.noMorePages': 'Басқа бет жоқ',
    'vacancies.showMoreTitle': 'Тағы вакансия көрсету',

    'chat.export.title': 'Чатты экспорттау',
    'chat.export.button': 'Экспорт',
    'chat.clearTitle': 'Чатты тазалау',
    'chat.useDocsTitle': 'Құжаттарды қолдану ({count})',
    'chat.useDocsNoneTitle': 'Құжат жоқ. “Құжаттар” бөлімін ашыңыз.',
    'chat.docsButton': 'Құжаттар',
    'chat.startDialog': '{name} агентімен чат бастаңыз',
    'chat.processing': 'Өңделуде',
    'chat.attachmentAdded': 'Сурет тіркелді',
    'chat.attachTitle': 'Фото/құжат тіркеу',
    'chat.listening': 'Тыңдап тұрмын...',
    'chat.writeMessage': 'Хабарлама жазыңыз...',
    'chat.voiceInput': 'Дауыс енгізу',
    'chat.speak': 'Дыбыстау',
    'chat.copyAnswer': 'Жауапты көшіру',
    'chat.helpful': 'Пайдалы',
    'chat.notHelpful': 'Көмектеспеді',
    'chat.alert.voiceUnsupported': 'Браузеріңіз дауыс енгізуді қолдамайды.',
    'chat.confirm.clear': '{name} агентімен диалогты тазалау керек пе?',
    'chat.noKey': 'GEMINI_API_KEY жоқ',
    'chat.export.md.title': '{agent} агентімен чат',
    'chat.export.md.user': 'Пайдаланушы',
    'chat.export.md.exportedAt': 'Экспорт',
    'chat.export.md.attachment': '[тіркеме: сурет]',
    'chat.docsContextHeader': 'Құжаттарыңыздан контекст (жергілікті білім қоры):',

    'common.from': 'бастап',
    'common.to': 'дейін',

    'home.goAi': 'AI сервистеріне өту',
    'home.ai': 'AI',
    'home.auth': 'Кіру',
    'home.switchUser': 'Пайдаланушыны ауыстыру',
    'home.switch': 'Ауыстыру',
    'home.enter': 'Кіру',
    'home.about': 'Бағдарлама туралы',
    'home.aiSanaTitle': 'AI‑SANA',
    'home.aiSanaSubtitle': 'Технологиялар траекториясы • білім • DeepTech',
    'home.communityTitle': 'Комьюнити және іс-шаралар',
    'home.communitySubtitle': 'Серіктестер, университеттер және индустрия бір экожүйеде',
    'home.programText':
      'AI‑Sana — Қазақстанның мемлекеттік бағдарламасы. 2024 жылғы 11 желтоқсанда Президент бастамасымен іске қосылып, Ғылым және жоғары білім министрлігі тарапынан жүзеге асырылады. Мақсаты — білім, зерттеу және DeepTech стартаптарын іске қосу арқылы «AI‑ұлт» қалыптастыру.',
    'home.programGoals': 'Бағдарлама мақсаттары',
    'home.goal1': 'DeepTech бағытында стартаптарды іске қосу.',
    'home.goal2': 'Жасанды интеллект құзыреттерін дамыту.',
    'home.goal3': 'Зерттеу зертханалары мен AI әзірлеу орталықтарын құру.',
    'home.goal4': 'Студенттер мен оқытушылардың цифрлық сауаттылығын арттыру.',
    'home.mainDirections': 'Негізгі бағыттар',
    'home.dir1': 'AI саласында мамандарды оқыту және даярлау.',
    'home.dir2': 'Инновацияларды коммерцияландыру және экономикаға енгізу.',
    'home.dir3': 'AI технологияларын университет экожүйесіне интеграциялау.',
    'home.dir4': 'Ғылыми зерттеулерді және халықаралық коллаборацияларды қолдау.',
    'home.expectedEffects': 'Күтілетін нәтижелер',
    'home.effectsText':
      'Бағдарлама Қазақстанның AI саласындағы бәсекеге қабілеттілігін арттырып, студенттер мен оқытушыларға жаңа мүмкіндіктер береді және болашақтың инновациялық экономикасын қалыптастыруға жағдай жасайды.'
    ,

    'agent.abitur.name': 'AI-Abitur',
    'agent.abitur.fullName': 'Талапкер көмекшісі',
    'agent.abitur.description': 'Bolashak университетіне түсушілерге арналған цифрлық кеңесші.',
    'agent.abitur.primaryFunc': 'Мамандықтар, құжаттар тізімі және қабылдау шарттары бойынша кеңес.',

    'agent.kadr.name': 'KadrAI',
    'agent.kadr.fullName': 'HR және құжаттар',
    'agent.kadr.description': 'Студенттер мен қызметкерлерге анықтама/құжат берудің бір терезесі.',
    'agent.kadr.primaryFunc': 'Оқу орнынан анықтама, транскрипт, бұйрықтар және кадрлық сұрақтар.',

    'agent.nav.name': 'UniNav',
    'agent.nav.fullName': 'Студент навигаторы',
    'agent.nav.description': 'Университеттің оқу үдерістеріне сүйемелдеу.',
    'agent.nav.primaryFunc': 'Кесте, академиялық сұрақтар, оқу туралы анықтамалар.',

    'agent.career.name': 'CareerNavigator',
    'agent.career.fullName': 'Мансап кеңесшісі',
    'agent.career.description': 'Түлектер мен студенттердің жұмысқа орналасуына көмек.',
    'agent.career.primaryFunc': 'Қызылордадағы вакансияларды іздеу, түйіндеме бойынша кеңес.',

    'agent.room.name': 'UniRoom',
    'agent.room.fullName': 'Жатақхана көмекшісі',
    'agent.room.description': 'Студенттер үйіндегі тұрмыстық және әкімшілік мәселелер.',
    'agent.room.primaryFunc': 'Қоныстану, жөндеу өтінімдері, тұру ережелері.'
    ,

    'admin.title': 'Bolashak AI басқару жүйесі',
    'admin.subtitle': 'Мониторинг, пайдаланушылар, хабарландырулар, аудит және бэкаптар.',
    'admin.tab.stats': 'Аналитика',
    'admin.tab.users': 'Пайдаланушылар',
    'admin.tab.broadcast': 'Жіберілім',
    'admin.tab.audit': 'Аудит',
    'admin.tab.backup': 'Бэкап',
    'admin.stat.requests': 'Сұраныстар',
    'admin.stat.requestsSub': 'Барлығы (user-msg)',
    'admin.stat.avgLatencySub': 'Орташа кідіріс',
    'admin.stat.ratings': 'Бағалар: {count}',
    'admin.stat.users': 'Пайдаланушылар',
    'admin.chart.byAgents': 'Агенттер бойынша сұраныстар',
    'admin.chart.trend14': 'Динамика (14 күн)',
    'admin.nodes.status': 'AI түйіндерінің мәртебесі',
    'admin.users.title': 'Пайдаланушылар',
    'admin.users.subtitle': 'Іздеу, рөлдер және бөлімдер (браузерде жергілікті).',
    'admin.users.searchPlaceholder': 'Аты, email, рөл бойынша іздеу…',
    'admin.users.col.name': 'Аты',
    'admin.users.col.role': 'Рөлі',
    'admin.users.col.department': 'Бөлім',
    'admin.users.add': 'Пайдаланушы қосу',
    'admin.users.placeholder.fullName': 'Аты-жөні',
    'admin.users.placeholder.password': 'Құпиясөз',
    'admin.users.placeholder.departmentOpt': 'Бөлім (міндетті емес)',
    'admin.users.create': 'Жасау',
    'admin.users.err.passwordMin': 'Құпиясөз кемінде 6 таңба болуы керек.',
    'admin.users.err.emailExists': 'Осы email-мен пайдаланушы бар.',
    'admin.broadcast.defaultTitle': 'Хабарландыру',
    'admin.broadcast.title': 'Хабарландыру жіберу',
    'admin.broadcast.subtitle': 'Барлық пайдаланушыға хабарлама жібереді (localStorage).',
    'admin.broadcast.total': 'Хабарландыру саны: {count}',
    'admin.broadcast.placeholder.title': 'Тақырып',
    'admin.broadcast.placeholder.message': 'Хабарлама мәтіні…',
    'admin.broadcast.params': 'Параметрлер',
    'admin.broadcast.sendAll': 'Барлығына жіберу',
    'admin.broadcast.sent': 'Хабарландыру барлық пайдаланушыға жіберілді.',
    'admin.broadcast.tip': 'Кеңес: студентке хабарландыру қалай шығатынын көрсетіңіз (“Хабарландырулар” бөлімі).',
    'admin.audit.title': 'Аудит (соңғы оқиғалар)',
    'admin.audit.subtitle': 'Жергілікті әрекет журналы (чат, құжаттар, әкімші панелі).',
    'admin.audit.confirmClear': 'Аудитті тазалау керек пе?',
    'admin.audit.clear': 'Тазалау',
    'admin.audit.none': 'Оқиғалар әзірге жоқ',
    'admin.backup.title': 'Резервтік көшірмелер',
    'admin.backup.subtitle': 'Деректерді экспорт/импорт (users/messages/docs/notifications/feedback/audit).',
    'admin.backup.exportJson': 'JSON экспорт',
    'admin.backup.import': 'Импорт',
    'admin.backup.chooseFile': 'Файл таңдау',
    'admin.backup.selectFileFirst': 'Алдымен файл таңдаңыз.',
    'admin.backup.importDone': 'Импорт аяқталды. Интерфейс жаңармаса, бетті қайта жүктеңіз.',
    'admin.backup.instructions': 'Бэкап файлын таңдаңыз. Деректерді ауыстыруға немесе біріктіруге (merge) болады.',
    'admin.backup.summary': 'Қорытынды'
  }
};

export function langToLocale(lang: Lang): string {
  if (lang === 'kk') return 'kk-KZ';
  if (lang === 'en') return 'en-US';
  return 'ru-RU';
}

function detectInitialLang(): Lang {
  try {
    const stored = localStorage.getItem(STORAGE_KEY) as Lang | null;
    if (stored === 'ru' || stored === 'en' || stored === 'kk') return stored;
  } catch {
    // ignore
  }
  const nav = (typeof navigator !== 'undefined' ? navigator.language : '') || '';
  if (nav.toLowerCase().startsWith('kk')) return 'kk';
  if (nav.toLowerCase().startsWith('ru')) return 'ru';
  return 'en';
}

function format(template: string, params?: Params): string {
  if (!params) return template;
  return template.replace(/\{(\w+)\}/g, (_m, key: string) => {
    const v = params[key];
    return v == null ? '' : String(v);
  });
}

type I18nContextValue = {
  lang: Lang;
  locale: string;
  setLang: (lang: Lang) => void;
  t: (key: string, params?: Params, fallback?: string) => string;
};

const I18nContext = createContext<I18nContextValue | null>(null);

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [lang, setLangState] = useState<Lang>(() => detectInitialLang());

  const setLang = useCallback((next: Lang) => {
    setLangState(next);
    try {
      localStorage.setItem(STORAGE_KEY, next);
    } catch {
      // ignore
    }
  }, []);

  useEffect(() => {
    try {
      localStorage.setItem(STORAGE_KEY, lang);
    } catch {
      // ignore
    }
  }, [lang]);

  const locale = useMemo(() => langToLocale(lang), [lang]);

  const t = useCallback(
    (key: string, params?: Params, fallback?: string) => {
      const raw = MESSAGES[lang][key] ?? MESSAGES.ru[key] ?? fallback ?? key;
      return format(raw, params);
    },
    [lang]
  );

  const value = useMemo<I18nContextValue>(() => ({ lang, locale, setLang, t }), [lang, locale, setLang, t]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export function useI18n(): I18nContextValue {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within LanguageProvider');
  return ctx;
}

export function useT() {
  return useI18n().t;
}
